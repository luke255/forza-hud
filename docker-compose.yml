version: '3.8'

services:
  forza-hud:
    build: .
    container_name: forza-hud
    restart: unless-stopped
    ports:
      - "8080:8080"           # Web interface
      - "20127:20127/udp"     # UDP telemetry data
    environment:
      - PORT=${PORT:-8080}
      - UDP_PORT=${UDP_PORT:-20127}
      - SPEED_UNIT=${SPEED_UNIT:-km/h}
      - POWER_UNIT=${POWER_UNIT:-kW}
      - TORQUE_UNIT=${TORQUE_UNIT:-Nm}
      - BOOST_UNIT=${BOOST_UNIT:-bar}
      - MQTT_BROKER_URL=${MQTT_BROKER_URL:-mqtt://localhost:1883}
      - MQTT_USERNAME=${MQTT_USERNAME:-}
      - MQTT_PASSWORD=${MQTT_PASSWORD:-}
      - DEVICE_UID_PREFIX=${DEVICE_UID_PREFIX:-forza_hud_}
      - DEVICE_IDENTIFIERS=${DEVICE_IDENTIFIERS:-forza_hud}
      - DEVICE_MANUFACTURER=${DEVICE_MANUFACTURER:-Forza}
      - DEVICE_MODEL=${DEVICE_MODEL:-Horizon}
      - DEVICE_NAME=${DEVICE_NAME:-Forza HUD}
      - DEVICE_SW_VERSION=${DEVICE_SW_VERSION:-1.0.0}
    volumes:
      - ./public:/usr/src/app/public:ro
      - ./app.js:/usr/src/app/app.js:ro
      - ./package.json:/usr/src/app/package.json:ro
    # Optional: if you have a custom .env file, you can load it
    env_file:
      - .env
    networks:
      - forza-network

networks:
  forza-network:
    driver: bridge